<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Timer Deluxe</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Load Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Configure Tailwind -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              inter: ['Inter', 'sans-serif'],
            },
            colors: {
              // Custom colors for themes
              'session-primary': 'rgb(20 184 166)', // teal-500
              'session-secondary': 'rgb(13 148 136)', // teal-600
              'session-shadow': 'rgb(20 184 166 / 0.4)',
              'break-primary': 'rgb(59 130 246)', // blue-500
              'break-secondary': 'rgb(37 99 235)', // blue-600
              'break-shadow': 'rgb(59 130 246 / 0.4)',
            }
          }
        },
        plugins: [
          // require('tailwind-scrollbar'), // This plugin is not available in CDN, so we'll use CSS
        ],
      }
    </script>
    
    <!-- Animated Gradient & Transition Styles -->
    <style>
      @keyframes gradient-flow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      
      body {
        background-size: 400% 400%;
        animation: gradient-flow 15s ease infinite;
        transition: background 1s ease;
        min-height: 100vh;
      }

      /* Theme-based gradients */
      body.theme-session {
        /* teal/green */
        background-image: linear-gradient(-45deg, #064e3b, #1e3a8a, #065f46, #14b8a6);
      }
      body.theme-break {
        /* blue/cyan */
        background-image: linear-gradient(-45deg, #1e3a8a, #0c4a6e, #0891b2, #3b82f6);
      }
      
      html, #root {
        min-height: 100vh;
      }
      
      /* Modal transition */
      .modal-enter { opacity: 0; }
      .modal-enter-active { opacity: 1; transition: opacity 300ms ease-out; }
      .modal-exit { opacity: 1; }
      .modal-exit-active { opacity: 0; transition: opacity 300ms ease-in; }
      
      .modal-content-enter { opacity: 0; transform: scale(0.95); }
      .modal-content-enter-active { opacity: 1; transform: scale(1); transition: all 300ms cubic-bezier(0.16, 1, 0.3, 1); }
      .modal-content-exit { opacity: 1; transform: scale(1); }
      .modal-content-exit-active { opacity: 0; transform: scale(0.95); transition: all 300ms cubic-bezier(0.16, 1, 0.3, 1); }
      
      /* Task animation */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .task-item-enter {
        animation: fadeIn 0.3s ease-out;
      }

      /* Custom Scrollbar */
      .custom-scrollbar::-webkit-scrollbar {
        width: 8px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        border: 3px solid transparent;
      }
      .custom-scrollbar {
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
      }
      
    </style>
</head>
<body class="theme-session">
    <!-- React app will mount here -->
    <div id="root"></div>

    <!-- Audio Element -->
    <audio
      id="beep"
      src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"
      preload="auto"
    ></audio>

    <!-- Load React libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Load Babel to transpile JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- React Component Code (transpiled by Babel) -->
    <script type="text/babel">
      const { useState, useEffect, useRef, useCallback } = React;
      
      const DEFAULT_SESSION = 25;
      const DEFAULT_BREAK = 5;
      const TASKS_STORAGE_KEY = 'pomodoroTasks';

      // --- SVG Icons (Cleaner, standard style) --- //
      const MinusIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
          <path d="M5 12h14"/>
        </svg>
      );

      const PlusIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
          <path d="M5 12h14"/><path d="M12 5v14"/>
        </svg>
      );

      const PlayIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-8 h-8">
          <path strokeLinecap="round" strokeLinejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347c.75.413.75 1.559 0 1.972l-11.54 6.347c-.75.413-1.667-.13-1.667-.986V5.653Z" />
        </svg>
      );

      const PauseIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-8 h-8">
          <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 5.25v13.5m-7.5-13.5v13.5" />
        </svg>
      );

      const ResetIcon = () => (
       <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-8 h-8">
          <path strokeLinecap="round" strokeLinejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
        </svg>
      );
      
      const SettingsIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
          <circle cx="12" cy="12" r="3"/>
        </svg>
      );
      
      const CloseIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M18 6 6 18M6 6l12 12"/>
        </svg>
      );
      
      const BellIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>
        </svg>
      );
      
      const BellOffIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M13.73 21a2 2 0 0 1-3.46 0"/><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="m2 2 20 20"/>
        </svg>
      );

      const TrashIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
          <line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/>
        </svg>
      );
      
      // --- React Components --- //

      // Button Component for consistent styling and animation
      const ControlButton = ({ id, onClick, children, className = '', ...props }) => (
        <button
          id={id}
          onClick={onClick}
          className={`p-3 rounded-full text-white bg-white/20 hover:bg-white/30 active:bg-white/10 transition-all duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-white/50 disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-110 active:scale-95 ${className}`}
          {...props}
        >
          {children}
        </button>
      );

      // Length Control Component
      const LengthControl = ({ type, label, length, increment, decrement, isRunning }) => (
        <div className="flex flex-col items-center space-y-3 p-4 bg-white/10 backdrop-blur-sm rounded-xl shadow-lg w-full">
          <h3 id={`${type}-label`} className="text-sm font-medium text-white/70 uppercase tracking-widest">
            {label}
          </h3>
          <div className="flex items-center space-x-4">
            <ControlButton id={`${type}-decrement`} onClick={decrement} disabled={isRunning} aria-label={`Decrease ${label}`}>
              <MinusIcon />
            </ControlButton>
            <span id={`${type}-length`} className="text-4xl font-bold text-white w-12 text-center tabular-nums">
              {length}
            </span>
            <ControlButton id={`${type}-increment`} onClick={increment} disabled={isRunning} aria-label={`Increase ${label}`}>
              <PlusIcon />
            </ControlButton>
          </div>
        </div>
      );

      // Timer Display Component with Progress Ring
      const TimerDisplay = ({ label, timeLeft, formatTime, totalDuration, mode, focusTaskText }) => {
        const percentage = totalDuration > 0 ? ((totalDuration - timeLeft) / totalDuration) * 100 : 0;
        const circumference = 2 * Math.PI * 140; // Assuming radius 140
        const strokeDashoffset = circumference - (percentage / 100) * circumference;

        const themeColors = {
          session: { ring: 'stroke-session-primary', text: 'text-session-primary' },
          break: { ring: 'stroke-break-primary', text: 'text-break-primary' },
        };

        const { ring, text } = themeColors[mode];

        return (
          <div className="relative flex flex-col items-center justify-center my-6 h-[320px] sm:h-[400px]">
            {/* Background Circle */}
            <svg className="absolute w-[320px] h-[320px] sm:w-[400px] sm:h-[400px]" viewBox="0 0 320 320">
              <circle
                cx="160" cy="160" r="140"
                strokeWidth="15"
                fill="none"
                className="text-white/10 stroke-current"
              />
            </svg>
            {/* Progress Circle */}
            <svg className="absolute w-[320px] h-[320px] sm:w-[400px] sm:h-[400px] transform -rotate-90" viewBox="0 0 320 320">
              <circle
                cx="160" cy="160" r="140"
                strokeWidth="15"
                fill="none"
                strokeDasharray={circumference}
                strokeDashoffset={strokeDashoffset}
                strokeLinecap="round"
                className={`${ring} stroke-current transition-all duration-1000 ease-linear`} // Animate strokeDashoffset
              />
            </svg>
            {/* Timer Text */}
            <div className="relative z-10 flex flex-col items-center justify-center p-8 rounded-full text-center">
               <h2 id="timer-label" className={`text-2xl font-semibold uppercase tracking-wider mb-2 transition-colors duration-300 ${text}`}>
                {label}
              </h2>
              <div id="time-left" className="text-7xl sm:text-8xl font-light text-white tabular-nums">
                {formatTime(timeLeft)}
              </div>
              {/* Focus Task Display */}
              {mode === 'session' && focusTaskText && (
                <p className="text-lg text-white/80 mt-2 truncate max-w-[200px]" title={focusTaskText}>
                  {focusTaskText}
                </p>
              )}
            </div>
          </div>
        );
      };
      
      // Settings Modal Component
      const SettingsModal = ({ 
        isOpen, 
        onClose, 
        sessionLength, 
        breakLength, 
        handleLengthChange, 
        isRunning 
      }) => {
        if (!isOpen) return null;

        return (
          <div 
            className="fixed inset-0 z-40 flex items-center justify-center p-4 modal-enter modal-enter-active"
            aria-labelledby="settings-title"
            role="dialog"
            aria-modal="true"
          >
            {/* Modal Overlay */}
            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm" onClick={onClose} aria-hidden="true"></div>
            
            {/* Modal Content */}
            <div className="relative z-50 w-full max-w-lg bg-black/20 backdrop-blur-xl rounded-2xl shadow-2xl p-6 sm:p-10 border border-white/10 modal-content-enter modal-content-enter-active">
              <div className="flex justify-between items-center mb-6">
                <h2 id="settings-title" className="text-3xl font-bold text-white">
                  Settings
                </h2>
                <button
                  onClick={onClose}
                  className="p-2 rounded-full text-white/70 bg-white/10 hover:bg-white/20 transition-all duration-200 transform hover:scale-110 active:scale-95"
                  aria-label="Close settings"
                >
                  <CloseIcon />
                </button>
              </div>
              
              {/* Length Controls inside Modal */}
              <div className="grid grid-cols-1 sm:grid-cols-2 justify-center gap-4">
                <LengthControl
                  type="session"
                  label="Session"
                  length={sessionLength}
                  increment={() => handleLengthChange('session', 1)}
                  decrement={() => handleLengthChange('session', -1)}
                  isRunning={isRunning}
                />
                <LengthControl
                  type="break"
                  label="Break"
                  length={breakLength}
                  increment={() => handleLengthChange('break', 1)}
                  decrement={() => handleLengthChange('break', -1)}
                  isRunning={isRunning}
                />
              </div>
              
              <div className="mt-8 text-center">
                 <button
                  onClick={onClose}
                  className="px-6 py-3 font-semibold text-white bg-white/20 hover:bg-white/30 rounded-full transition-all duration-200 transform hover:scale-105 active:scale-95"
                >
                  Done
                </button>
              </div>
            </div>
          </div>
        );
      };

      // Task Item Component
      const TaskItem = ({ task, onToggle, onDelete, onSetFocus, isFocused }) => (
        <li className={`flex items-center justify-between p-3 rounded-lg task-item-enter transition-all duration-200 ${isFocused ? 'ring-2 ring-session-primary bg-white/20' : 'bg-white/10'}`}>
          <div className="flex items-center space-x-3 overflow-hidden">
            <input
              type="checkbox"
              checked={task.completed}
              onChange={() => onToggle(task.id)}
              className="w-5 h-5 rounded flex-shrink-0 text-session-primary bg-white/20 border-none focus:ring-2 focus:ring-session-primary focus:ring-offset-0 focus:ring-offset-transparent"
            />
            <span 
              className={`text-lg truncate cursor-pointer ${task.completed ? 'text-white/40 line-through' : 'text-white'} ${isFocused ? 'font-semibold' : ''}`}
              onClick={() => onSetFocus(task.id)}
              title={task.text}
            >
              {task.text}
            </span>
          </div>
          <button
            onClick={() => onDelete(task.id)}
            className="p-2 rounded-full flex-shrink-0 text-white/50 hover:text-rose-400 hover:bg-white/10 transition-all duration-200"
            aria-label="Delete task"
          >
            <TrashIcon />
          </button>
        </li>
      );

      // Main App Component
      function App() {
        const [breakLength, setBreakLength] = useState(DEFAULT_BREAK);
        const [sessionLength, setSessionLength] = useState(DEFAULT_SESSION);
        
        const [timeLeft, setTimeLeft] = useState(DEFAULT_SESSION * 60);
        const [isRunning, setIsRunning] = useState(false);
        const [currentMode, setCurrentMode] = useState('session'); // 'session', 'break'
        const [isSettingsOpen, setIsSettingsOpen] = useState(false);
        const [isSoundOn, setIsSoundOn] = useState(true);
        const [hasNotifPermission, setHasNotifPermission] = useState(Notification.permission === 'granted');
        
        // Load tasks from localStorage on initial render
        const [tasks, setTasks] = useState(() => {
          const savedTasks = localStorage.getItem(TASKS_STORAGE_KEY);
          return savedTasks ? JSON.parse(savedTasks) : [];
        });
        const [newTaskText, setNewTaskText] = useState("");
        const [focusTaskId, setFocusTaskId] = useState(null);
        
        const audioRef = useRef(null);
        const intervalRef = useRef(null);
        
        // Get audio element on mount
        useEffect(() => {
            audioRef.current = document.getElementById('beep');
        }, []);
        
        // Check notification permission on mount
        useEffect(() => {
          if ('Notification' in window) {
            setHasNotifPermission(Notification.permission === 'granted');
          }
        }, []);

        // Save tasks to localStorage whenever they change
        useEffect(() => {
          localStorage.setItem(TASKS_STORAGE_KEY, JSON.stringify(tasks));
        }, [tasks]);

        // Calculate total duration for progress ring based on current mode
        const totalDuration = (currentMode === 'session' ? sessionLength : breakLength) * 60;

        // Format time function (mm:ss)
        const formatTime = useCallback((time) => {
          const minutes = Math.floor(time / 60);
          const seconds = time % 60;
          return `${minutes < 10 ? '0' : ''}${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }, []);
        
        // Capitalize mode for display
        const displayLabel = currentMode.charAt(0).toUpperCase() + currentMode.slice(1);
        
        // Get text for the currently focused task
        const focusTask = tasks.find(t => t.id === focusTaskId);

        // Dynamic Document Title
        useEffect(() => {
          if (isRunning) {
            document.title = `${formatTime(timeLeft)} - ${displayLabel}`;
          } else if (timeLeft === totalDuration) {
             document.title = "Pomodoro Timer Deluxe";
          } else {
            document.title = `Paused - Pomodoro Timer`;
          }
        }, [timeLeft, isRunning, displayLabel, formatTime, totalDuration]);
        
        // Dynamic Body Theme
        useEffect(() => {
          document.body.className = `theme-${currentMode}`;
        }, [currentMode]);
        
        // Function to show notification
        const showNotification = (title, body) => {
          if (hasNotifPermission) {
            new Notification(title, { body });
          }
        };

        // Timer logic
        useEffect(() => {
          if (isRunning) {
            intervalRef.current = setInterval(() => {
              setTimeLeft(prev => {
                if (prev <= 0) {
                  // Play sound
                  if (isSoundOn) {
                    audioRef.current?.play().catch(e => console.error("Audio play failed:", e));
                  }
                  
                  // Switch session type and set new time
                  if(currentMode === 'session') {
                    showNotification('Session Complete!', 'Time for a break.');
                    // Start Break
                    setCurrentMode('break');
                    setTimeLeft(breakLength * 60);
                    return breakLength * 60; // Return new time
                  } else {
                    showNotification('Break Over!', 'Time to get back to focus.');
                    // Start Session
                    setCurrentMode('session');
                    setTimeLeft(sessionLength * 60);
                    return sessionLength * 60; // Return new time
                  }
                }
                return prev - 1;
              });
            }, 1000);
          } else {
            clearInterval(intervalRef.current);
          }
          // Cleanup interval
          return () => clearInterval(intervalRef.current);
        }, [isRunning, currentMode, breakLength, sessionLength, isSoundOn, hasNotifPermission]);

        // Reset handler
        const handleReset = useCallback(() => {
          clearInterval(intervalRef.current); // Stop timer
          setIsRunning(false);
          setCurrentMode('session');
          setBreakLength(DEFAULT_BREAK);
          setSessionLength(DEFAULT_SESSION);
          setTimeLeft(DEFAULT_SESSION * 60);
          if (audioRef.current) {
            audioRef.current.pause();
            audioRef.current.currentTime = 0;
          }
        }, []);

        // Start/Stop handler
        const handleStartStop = useCallback(() => {
          // Request notification permission if not already granted or denied
          if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission().then(permission => {
              setHasNotifPermission(permission === 'granted');
            });
          }
          setIsRunning(prev => !prev);
        }, []);

        // Increment/Decrement handlers with validation
        const handleLengthChange = useCallback((type, delta) => {
          if (isRunning) return; // Prevent changes while running

          const setLength = (setter, newLength) => {
            if (newLength >= 1 && newLength <= 60) {
              setter(newLength);
              // If timer is not running and matches the mode we're changing, update timeLeft
              if (currentMode === type) {
                setTimeLeft(newLength * 60);
              }
              return newLength;
            }
          };

          if (type === 'break') {
            setBreakLength(prev => setLength(setBreakLength, prev + delta) ?? prev);
          } else if (type === 'session') {
            setSessionLength(prev => setLength(setSessionLength, prev + delta) ?? prev);
          }
          
        }, [isRunning, currentMode]);
        
        // --- Task Handlers --- //
        const handleAddTask = (e) => {
          e.preventDefault();
          if (newTaskText.trim() === "") return;
          const newTask = {
            id: Date.now(),
            text: newTaskText,
            completed: false
          };
          setTasks(prevTasks => [...prevTasks, newTask]);
          setNewTaskText("");
        };
        
        const handleToggleTask = (id) => {
          // Unfocus task if it's being marked as complete
          if (focusTaskId === id) {
             const task = tasks.find(t => t.id === id);
             if (task && !task.completed) {
               setFocusTaskId(null);
             }
          }
          
          setTasks(prevTasks =>
            prevTasks.map(task =>
              task.id === id ? { ...task, completed: !task.completed } : task
            )
          );
        };

        const handleDeleteTask = (id) => {
          // Unfocus task if it's being deleted
          if (focusTaskId === id) {
            setFocusTaskId(null);
          }
          setTasks(prevTasks => prevTasks.filter(task => task.id !== id));
        };
        
        const handleSetFocus = (id) => {
          const task = tasks.find(t => t.id === id);
          // Can't focus a completed task
          if (task && task.completed) {
            setFocusTaskId(null);
            return;
          }
          // Toggle focus
          setFocusTaskId(prevId => (prevId === id ? null : id));
        };
        
        const handleClearCompleted = () => {
          setTasks(prevTasks => prevTasks.filter(task => !task.completed));
        };
        
        // Determine main button theme
        const mainButtonTheme = {
          session: 'bg-session-primary hover:bg-session-secondary active:bg-session-secondary shadow-lg shadow-session-shadow',
          break: 'bg-break-primary hover:bg-break-secondary active:bg-break-secondary shadow-lg shadow-break-shadow',
        }

        return (
          <>
            <div className="flex flex-col items-center justify-center min-h-screen text-slate-100 font-inter p-4 py-12">
              <div className="w-full max-w-xl mx-auto bg-black/20 backdrop-blur-xl rounded-2xl shadow-2xl p-6 sm:p-10 border border-white/10">
                
                {/* Header with Title and Controls */}
                <div className="flex justify-between items-center w-full mb-6">
                   <h1 className="text-3xl sm:text-4xl font-bold text-white drop-shadow-md">
                    Pomodoro Timer
                  </h1>
                  <div className="flex items-center space-x-2">
                    <button
                      onClick={() => setIsSoundOn(prev => !prev)}
                      className="p-3 rounded-full text-white/70 bg-white/10 hover:bg-white/20 transition-all duration-200 transform hover:scale-110 active:scale-95"
                      aria-label={isSoundOn ? "Mute sound" : "Unmute sound"}
                    >
                      {isSoundOn ? <BellIcon /> : <BellOffIcon />}
                    </button>
                    <button
                      onClick={() => setIsSettingsOpen(true)}
                      className="p-3 rounded-full text-white/70 bg-white/10 hover:bg-white/20 transition-all duration-200 transform hover:scale-110 active:scale-95"
                      aria-label="Open settings"
                    >
                      <SettingsIcon />
                    </button>
                  </div>
                </div>

                {/* Timer Display */}
                <TimerDisplay
                  label={displayLabel}
                  timeLeft={timeLeft}
                  formatTime={formatTime}
                  totalDuration={totalDuration}
                  mode={currentMode}
                  focusTaskText={focusTask?.text}
                />

                {/* Main Controls */}
                <div className="flex justify-center items-center space-x-6">
                  <ControlButton
                     id="start_stop"
                     onClick={handleStartStop}
                     className={`w-20 h-20 flex items-center justify-center transform hover:scale-110 active:scale-95 ${mainButtonTheme[currentMode]}`}
                     aria-label={isRunning ? 'Pause Timer' : 'Start Timer'}
                    >
                    {isRunning ? <PauseIcon /> : <PlayIcon />}
                  </ControlButton>
                  <ControlButton
                     id="reset"
                     onClick={handleReset}
                     className="bg-rose-600 hover:bg-rose-500 active:bg-rose-700 w-20 h-20 flex items-center justify-center shadow-lg shadow-rose-600/40 hover:shadow-rose-500/50 transform hover:scale-110 active:scale-95"
                     aria-label="Reset Timer"
                     >
                    <ResetIcon />
                  </ControlButton>
                </div>
                
                {/* Divider */}
                <hr className="border-t border-white/10 my-8" />
                
                {/* Task Section */}
                <div>
                  <h3 className="text-2xl font-bold text-white mb-4">Tasks</h3>
                  <form onSubmit={handleAddTask} className="flex space-x-2 mb-4">
                    <input
                      type="text"
                      value={newTaskText}
                      onChange={(e) => setNewTaskText(e.target.value)}
                      placeholder="What are you working on?"
                      className="flex-grow p-3 bg-white/10 rounded-lg border-none text-white placeholder-white/40 focus:ring-2 focus:ring-session-primary focus:outline-none"
                    />
                    <button
                      type="submit"
                      className="px-5 py-2.5 font-semibold flex-shrink-0 flex items-center justify-center rounded-lg bg-session-primary hover:bg-session-secondary shadow-lg shadow-session-shadow transition-all duration-200 transform hover:scale-105 active:scale-95"
                      aria-label="Add task"
                    >
                      Add Task
                    </button>
                  </form>
                  
                  {/* Task List */}
                  <ul className="space-y-2 max-h-48 overflow-y-auto custom-scrollbar pr-2">
                    {tasks.length === 0 && (
                      <p className="text-center text-white/50">No tasks yet. Add one!</p>
                    )}
                    {tasks.map(task => (
                      <TaskItem
                        key={task.id}
                        task={task}
                        onToggle={handleToggleTask}
                        onDelete={handleDeleteTask}
                        onSetFocus={handleSetFocus}
                        isFocused={task.id === focusTaskId}
                      />
                    ))}
                  </ul>
                  
                  {/* Task List Footer */}
                  {tasks.some(t => t.completed) && (
                    <div className="mt-4 text-center">
                      <button 
                        onClick={handleClearCompleted}
                        className="text-sm font-semibold text-white/60 hover:text-white transition-all duration-200"
                      >
                        Clear Completed Tasks
                      </button>
                    </div>
                  )}
                </div>
                
              </div>
            </div>
            
            {/* Settings Modal Render */}
            <SettingsModal
              isOpen={isSettingsOpen}
              onClose={() => setIsSettingsOpen(false)}
              sessionLength={sessionLength}
              breakLength={breakLength}
              handleLengthChange={handleLengthChange}
              isRunning={isRunning}
            />
          </>
        );
      }
      
      // Mount the React app
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);

    </script>
</body>
</html>

